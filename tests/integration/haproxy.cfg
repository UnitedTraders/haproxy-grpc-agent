# T050: HAProxy configuration for integration testing
# Tests Agent Text Protocol integration

global
    log stdout format raw local0 debug

defaults
    log     global
    mode    http
    timeout connect 5000ms
    timeout client  50000ms
    timeout server  50000ms

# Frontend for testing
frontend test_frontend
    bind *:8080
    default_backend grpc_backend

# Backend using our agent for health checks
backend grpc_backend
    mode http
    balance roundrobin

    # Use our agent for health checks
    option external-check
    external-check command /usr/local/bin/grpc-agent-check.sh

    # Backend server
    server backend1 grpc-backend:50051 check

# Agent configuration would go here in production
# For testing, we'll use a simple script that connects to our agent
